<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GTM & Stock Average App</title>
  
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="lib/css/bootstrap4.6.1.min.css">
  
  <!-- (Optional) Font Awesome for Icons -->
  <link 
    rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" 
    integrity="sha512-OkD1nCn6dZzJtC6OGx0Gv82ZASVal8QXYeJl5Q2OWq+BW+2FYD44s06Idq0gVaYM3Bh1qp0vMG2sT9lZdbi3Fw==" 
    crossorigin="anonymous" referrerpolicy="no-referrer" 
  />

  <!-- jQuery -->
  <script src="lib/scripts/jquery.slim.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="lib/scripts/bootstrap4.6.1.min.js"></script>

  <script>
    // Hide both sections by default, then show the requested one
    function showSection(sectionID) {
      // Hide both
      document.getElementById("gtmSection").style.display = "none";
      document.getElementById("stockAverageSection").style.display = "none";

      // Show the requested section
      document.getElementById(sectionID).style.display = "block";
    }

    /********************************
     * 1) GOLD TO CURRENCY (GTM)
     ********************************/
    function calcluate(){
      var sar_amount_to_send    = parseFloat(document.getElementById('sar_amount_to_send').value);
      var sar_to_inr            = parseFloat(document.getElementById('sar_to_inr').value);
      var gold_rate_10g_ksa_sar = parseFloat(document.getElementById('gold_rate_10g_ksa_sar').value);
      var gold_rate_10g_ind_inr = parseFloat(document.getElementById('gold_rate_10g_ind_inr').value);

      if (
        isNaN(sar_amount_to_send) || 
        isNaN(sar_to_inr) ||
        isNaN(gold_rate_10g_ksa_sar) || 
        isNaN(gold_rate_10g_ind_inr)
      ){
        alert('Please provide valid input in GTM form.');
        return;
      }

      var gold_weight_possible_per_tola   = (sar_amount_to_send / gold_rate_10g_ksa_sar).toFixed(2);
      var purchased_gold_price_in_ind_inr = gold_weight_possible_per_tola * gold_rate_10g_ind_inr;
      var exchanged_amount_sent           = sar_amount_to_send * sar_to_inr;

      var output = '<table class="table table-striped">';
      output += '<tr>';
      output += '<td>Gold purchase capacity per 10g</td>';
      output += '<td>'+ gold_weight_possible_per_tola +'</td>';
      output += '</tr>';

      output += '<tr>';
      output += '<td>Gold Purchased Value In IND (INR)</td>';
      output += '<td>'+ purchased_gold_price_in_ind_inr +'</td>';
      output += '</tr>';

      output += '<tr>';
      output += '<td>SAR Sent Amount Value (INR)</td>';
      output += '<td>'+ exchanged_amount_sent +'</td>';
      output += '</tr>';

      output += '<tr>';
      output += '<td>Diff</td>';
      output += '<td>'+(purchased_gold_price_in_ind_inr - exchanged_amount_sent)+'</td>';
      output += '</tr>';
      output += '</table>';

      document.getElementById("output").innerHTML = output;
    }

    function clearFormGTM(){
      document.getElementById('sar_amount_to_send').value    = '';
      document.getElementById('sar_to_inr').value            = '';
      document.getElementById('gold_rate_10g_ksa_sar').value = '';
      document.getElementById('gold_rate_10g_ind_inr').value = '';
      document.getElementById("output").innerHTML = '';
    }


    /********************************
     * 2) STOCK AVERAGE
     ********************************/
    function calculateNewAverage(){
      const cost_price    = parseFloat(document.getElementById('cost_price').value);
      const quantity_held = parseFloat(document.getElementById('quantity_held').value);
      const market_price  = parseFloat(document.getElementById('market_price').value);
      const new_shares    = parseFloat(document.getElementById('new_shares').value);

      if (
        isNaN(cost_price) || 
        isNaN(quantity_held) ||
        isNaN(market_price) ||
        isNaN(new_shares)
      ) {
        alert("Please provide valid input in Stock Average form.");
        return;
      }

      // Reimplementing get_new_avg() from Python:
      // def get_new_avg(cost_price,quantity_held,market_price, new_shares):
      //     cost_value = cost_price * quantity_held
      //     new_shares_value = market_price * new_shares
      //     total_cost_value = cost_value + new_shares_value
      //     total_shares = quantity_held + new_shares
      //     new_avg = round((total_cost_value / total_shares), 2)
      //     return new_avg

      const cost_value       = cost_price * quantity_held;
      const new_shares_value = market_price * new_shares;
      const total_cost_value = cost_value + new_shares_value;
      const total_shares     = quantity_held + new_shares;
      const new_avg          = (total_cost_value / total_shares).toFixed(2);

      // Build a table that shows the inputs plus the new average
      let resultTable = `
        <table class="table table-striped">
          <tr>
            <td>Cost Price</td>
            <td>${cost_price}</td>
          </tr>
          <tr>
            <td>Quantity Held</td>
            <td>${quantity_held}</td>
          </tr>
          <tr>
            <td>Market Price</td>
            <td>${market_price}</td>
          </tr>
          <tr>
            <td>New Shares</td>
            <td>${new_shares}</td>
          </tr>
          <tr class="table-info">
            <td>New Average Price</td>
            <td><strong>${new_avg}</strong></td>
          </tr>
        </table>
      `;

      document.getElementById("avg_output").innerHTML = resultTable;
    }

    function clearFormStock(){
      document.getElementById('cost_price').value     = '';
      document.getElementById('quantity_held').value  = '';
      document.getElementById('market_price').value   = '';
      document.getElementById('new_shares').value     = '';
      document.getElementById("avg_output").innerHTML = '';
    }

    // On page load, show GTM by default
    document.addEventListener('DOMContentLoaded', function(){
      showSection("gtmSection"); 
    });
  </script>

  <style>
    /* Just an optional bit of styling to emphasize hidden vs shown sections */
    #gtmSection, #stockAverageSection {
      margin-top: 1rem;
    }
  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row">

    <!-- Main Content (Left Column) -->
    <div class="col-9">

      <!-- 1) GTM Section -->
      <div id="gtmSection"> 
        <!-- GTM Card -->
        <div class="card">
          <div class="card-header">
            GTM
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-3">&nbsp;</div>
              <div class="col-6">
                
                <div class="form-group row">
                  <label for="sar_to_inr">SAR-INR:</label>
                  <input type="text" class="form-control" id="sar_to_inr">
                </div>
                
                <div class="form-group row">
                  <label for="sar_amount_to_send">Amount to Send (SAR):</label>
                  <input type="text" class="form-control" id="sar_amount_to_send">
                </div>
                
                <div class="form-group row">
                  <label for="gold_rate_10g_ksa_sar">Gold Rate 10g KSA (SAR):</label>
                  <input type="text" class="form-control" id="gold_rate_10g_ksa_sar">
                </div>
                
                <div class="form-group row">
                  <label for="gold_rate_10g_ind_inr">Gold Rate 10g IND (INR):</label>
                  <input type="text" class="form-control" id="gold_rate_10g_ind_inr">
                </div>

              </div>
              <div class="col-3">&nbsp;</div>
            </div>
          </div>
          <div class="card-footer">
            <button type="button" class="btn btn-primary" onclick="calcluate()">Submit</button>
            <button type="button" class="btn btn-secondary" onclick="clearFormGTM()">Clear</button>
          </div>
        </div>

        <!-- GTM Result Card -->
        <div class="card mt-3">
          <div class="card-header">Result</div>
          <div class="card-body">
            <div class="row">
              <div class="col-3">&nbsp;</div>
              <div class="col-6">
                <div id="output"></div>
              </div>
              <div class="col-3">&nbsp;</div>
            </div>
          </div>
        </div>
      </div>
      <!-- End GTM Section -->


      <!-- 2) Stock Average Section -->
      <div id="stockAverageSection" style="display: none;"> 
        <!-- Stock Average Card -->
        <div class="card">
          <div class="card-header">
            Stock Average
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-3">&nbsp;</div>
              <div class="col-6">
                
                <div class="form-group row">
                  <label for="cost_price">Cost Price:</label>
                  <input type="text" class="form-control" id="cost_price">
                </div>
                
                <div class="form-group row">
                  <label for="quantity_held">Quantity Held:</label>
                  <input type="text" class="form-control" id="quantity_held">
                </div>
                
                <div class="form-group row">
                  <label for="market_price">Market Price:</label>
                  <input type="text" class="form-control" id="market_price">
                </div>
                
                <div class="form-group row">
                  <label for="new_shares">New Shares to Buy:</label>
                  <input type="text" class="form-control" id="new_shares">
                </div>

              </div>
              <div class="col-3">&nbsp;</div>
            </div>
          </div>
          <div class="card-footer">
            <button type="button" class="btn btn-primary" onclick="calculateNewAverage()">Submit</button>
            <button type="button" class="btn btn-secondary" onclick="clearFormStock()">Clear</button>
          </div>
        </div>

        <!-- Stock Average Result Card -->
        <div class="card mt-3">
          <div class="card-header">Stock Average Result</div>
          <div class="card-body">
            <div class="row">
              <div class="col-3">&nbsp;</div>
              <div class="col-6">
                <div id="avg_output"></div>
              </div>
              <div class="col-3">&nbsp;</div>
            </div>
          </div>
        </div>
      </div>
      <!-- End Stock Average Section -->

    </div>
    <!-- End of Main Content (Left Column) -->


    <!-- Right-Side Navigation (Menu) -->
    <div class="col-3 bg-light">
      <div class="card mt-3">
        <div class="card-header text-white bg-info">
          <i class="fas fa-bars"></i> Menu
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            <a 
              href="javascript:void(0)" 
              class="text-decoration-none" 
              onclick="showSection('gtmSection')"
            >
              <i class="fas fa-coins"></i> GTM
            </a>
          </li>
          <li class="list-group-item">
            <a 
              href="javascript:void(0)" 
              class="text-decoration-none" 
              onclick="showSection('stockAverageSection')"
            >
              <i class="fas fa-chart-line"></i> Stock Average
            </a>
          </li>
        </ul>
      </div>
    </div>
    <!-- End of Right-Side Navigation -->

  </div>
</div>

</body>
</html>
